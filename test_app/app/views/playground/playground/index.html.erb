<div class="playground-container min-h-screen flex flex-col bg-gray-50" 
     data-controller="playground"
     data-playground-execute-url-value="<%= playground_execute_path %>">
  
  <!-- Header -->
  <div class="bg-white shadow-sm border-b border-gray-200 px-6 py-3">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-4">
        <h1 class="text-xl font-bold text-gray-900">SwiftUI Rails Playground</h1>
        <div class="flex items-center gap-2 text-sm text-gray-600">
          <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
          <span>Live Preview</span>
        </div>
      </div>
      
      <div class="flex items-center gap-2">
        <!-- Snippet Selector -->
        <div class="relative" data-controller="dropdown">
          <button class="px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2"
                  data-action="click->dropdown#toggle">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            Snippets
          </button>
          
          <div class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-lg border border-gray-200 hidden z-10 max-h-96 overflow-y-auto"
               data-dropdown-target="menu">
            <div class="py-1">
              <% # Group snippets by category %>
              <% @snippets.group_by { |s| s[:category] }.each_with_index do |(category, category_snippets), index| %>
                <% if index > 0 %>
                  <div class="border-t border-gray-200 my-1"></div>
                <% end %>
                
                <div class="px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">
                  <%= category %>
                </div>
                
                <% category_snippets.each do |snippet| %>
                  <button class="w-full text-left px-4 py-2 hover:bg-gray-50 flex items-start gap-3 group"
                          data-action="click->playground#loadSnippet click->dropdown#close"
                          data-playground-snippet-code="<%= html_escape(snippet[:code]).gsub("\n", '\\n') %>">
                    <div class="flex-shrink-0 mt-0.5">
                      <% # Icon based on category %>
                      <% case category %>
                      <% when "Basic Components" %>
                        <svg class="w-4 h-4 text-gray-400 group-hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                        </svg>
                      <% when "Layout" %>
                        <svg class="w-4 h-4 text-gray-400 group-hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path>
                        </svg>
                      <% when "Interactive" %>
                        <svg class="w-4 h-4 text-gray-400 group-hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path>
                        </svg>
                      <% when "Forms" %>
                        <svg class="w-4 h-4 text-gray-400 group-hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                      <% when "Complex" %>
                        <svg class="w-4 h-4 text-gray-400 group-hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                        </svg>
                      <% end %>
                    </div>
                    <div class="flex-1">
                      <div class="font-medium text-sm text-gray-900 group-hover:text-blue-600"><%= snippet[:name] %></div>
                      <div class="text-xs text-gray-500"><%= snippet[:description] %></div>
                    </div>
                  </button>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <button class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 flex items-center gap-2"
                data-action="click->playground#execute">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          Run
        </button>
        
        <button class="px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50"
                data-action="click->playground#share">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
          </svg>
        </button>
        
        <button class="px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50"
                data-action="click->playground#export">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>
  
  <!-- Main Content Area -->
  <div class="flex-1 flex overflow-hidden" style="height: calc(100vh - 180px);">
    <!-- Code Editor Panel -->
    <div class="flex-1 flex flex-col border-r border-gray-200" style="flex: 0 0 55%;">
      <div class="bg-gray-100 px-4 py-2 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <span class="text-sm font-medium text-gray-700">Code Editor</span>
          <div class="flex items-center gap-2 text-xs text-gray-500">
            <kbd class="px-1.5 py-0.5 bg-gray-200 rounded">âŒ˜</kbd>
            <span>+</span>
            <kbd class="px-1.5 py-0.5 bg-gray-200 rounded">Enter</kbd>
            <span>to run</span>
          </div>
        </div>
      </div>
      
      <!-- Monaco Editor Container -->
      <div class="flex-1 relative">
        <!-- Temporary textarea until Monaco is integrated -->
        <textarea class="w-full h-full p-6 font-mono text-sm resize-none focus:outline-none bg-gray-50 border-0 leading-relaxed"
                  data-playground-target="codeInput"
                  placeholder="Enter your SwiftUI Rails DSL code here..."
                  spellcheck="false"><%= @initial_code %></textarea>
        
        <!-- Monaco container for future use -->
        <div id="monaco-editor-container" 
             class="absolute inset-0 hidden"
             data-playground-target="editor"
             data-controller="playground-editor"
             data-playground-editor-initial-code-value="<%= @initial_code %>">
          <!-- Monaco editor will be mounted here -->
        </div>
      </div>
    </div>
    
    <!-- Preview Panel -->
    <div class="flex-1 flex flex-col bg-white" style="flex: 0 0 45%;">
      <div class="bg-gray-100 px-4 py-2 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <span class="text-sm font-medium text-gray-700">Live Preview</span>
          <div class="flex items-center gap-2">
            <!-- Device Preview Selector -->
            <div class="flex items-center gap-1 bg-gray-200 rounded-lg p-1">
              <button class="px-2 py-1 text-xs font-medium rounded bg-white shadow-sm"
                      data-action="click->playground#setPreviewDevice"
                      data-playground-device-param="desktop">
                Desktop
              </button>
              <button class="px-2 py-1 text-xs font-medium rounded hover:bg-gray-100"
                      data-action="click->playground#setPreviewDevice"
                      data-playground-device-param="tablet">
                Tablet
              </button>
              <button class="px-2 py-1 text-xs font-medium rounded hover:bg-gray-100"
                      data-action="click->playground#setPreviewDevice"
                      data-playground-device-param="mobile">
                Mobile
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Preview Content -->
      <div class="flex-1 overflow-auto p-8" data-playground-target="previewContainer">
        <div id="playground-preview" class="min-h-full">
          <!-- Preview content will be rendered here -->
          <div class="flex items-center justify-center h-64 text-gray-400">
            <div class="text-center">
              <svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
              </svg>
              <p class="text-sm">Click "Run" to see your component</p>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Error Display -->
      <div id="playground-errors" class="hidden border-t border-red-200 bg-red-50 p-4">
        <!-- Errors will be displayed here -->
      </div>
    </div>
  </div>
  
  <!-- Component Inspector (Bottom Panel) -->
  <div class="border-t border-gray-200 bg-white" style="height: 120px; overflow: hidden;" 
       data-playground-target="inspector">
    <div class="h-full flex">
      <!-- Inspector Tabs -->
      <div class="w-48 border-r border-gray-200 bg-gray-50">
        <div class="p-2 space-y-1">
          <button class="w-full text-left px-3 py-2 text-sm font-medium bg-white rounded shadow-sm">
            Component Tree
          </button>
          <button class="w-full text-left px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded">
            Properties
          </button>
          <button class="w-full text-left px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded">
            Stimulus State
          </button>
          <button class="w-full text-left px-3 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded">
            Generated Code
          </button>
        </div>
      </div>
      
      <!-- Inspector Content -->
      <div class="flex-1 p-4 overflow-auto">
        <div class="text-sm text-gray-600">
          <p>Component inspection will appear here when you run your code.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Keyboard shortcuts helper -->
<script>
  document.addEventListener('keydown', function(e) {
    if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
      e.preventDefault();
      const playgroundController = document.querySelector('[data-controller="playground"]');
      if (playgroundController && playgroundController._stimulus) {
        const controller = playgroundController._stimulus.controllers.find(c => c.identifier === 'playground');
        if (controller && controller.execute) {
          controller.execute();
        }
      }
    }
  });
</script>